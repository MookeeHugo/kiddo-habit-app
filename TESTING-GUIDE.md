# 🧪 功能测试指南

## 📋 Phase 6: 测试与优化

本文档包含完整的功能测试清单、性能优化步骤和部署指南。

---

## 1️⃣ 功能测试清单

### A. 任务管理功能测试

#### 测试场景 1.1: 添加每日任务

**前置条件**: 应用已加载，在"我的任务"标签页

**测试步骤**:
1. 点击"➕ 添加任务"按钮
2. 填写任务信息：
   - 标题：`每天阅读30分钟`
   - 描述：`阅读课外书籍，积累知识`
   - 图标：选择 📚（学习类别）
   - 颜色：选择蓝色
   - 类型：选择"每日任务"
   - 难度：选择"中等"
   - 重复设置：选择"每天"
3. 点击"添加任务"按钮

**预期结果**:
- ✅ 任务成功添加到任务列表
- ✅ 显示 Toast 提示"任务添加成功"
- ✅ 任务卡片显示正确的图标、颜色和信息
- ✅ 任务状态为"未完成"（空心圆圈）
- ✅ 显示难度标签（⚡ 中等）

#### 测试场景 1.2: 添加待办事项（带子任务）

**测试步骤**:
1. 点击"➕ 添加任务"
2. 填写任务信息：
   - 标题：`完成数学作业`
   - 类型：选择"待办事项"
   - 截止日期：选择明天
   - 添加子任务：
     - `完成第1-5题`
     - `检查答案`
     - `整理错题`
3. 点击"添加任务"

**预期结果**:
- ✅ 任务添加成功
- ✅ 显示截止日期（明天的日期）
- ✅ 显示 3 个子任务（未勾选状态）
- ✅ 无重复设置（待办事项特性）

#### 测试场景 1.3: 完成任务并获得奖励

**测试步骤**:
1. 找到一个"中等"难度的未完成任务
2. 点击任务左侧的圆圈勾选框

**预期结果**:
- ✅ 圆圈变为绿色 ✓
- ✅ 播放完成动画（烟花/星星）
- ✅ 显示 Toast 提示：`🎉 太棒了！获得10积分和5经验值！`
- ✅ 用户积分增加 10 分
- ✅ 用户经验值增加 5 点
- ✅ 如果升级，显示升级动画和提示

#### 测试场景 1.4: 完成子任务

**测试步骤**:
1. 展开带子任务的任务
2. 勾选第一个子任务
3. 勾选第二个子任务
4. 勾选第三个子任务（全部完成）

**预期结果**:
- ✅ 每个子任务勾选后显示绿色 ✓
- ✅ 子任务完成进度更新（例如：1/3 → 2/3 → 3/3）
- ✅ 全部子任务完成后，主任务自动标记为完成
- ✅ 获得完成奖励

#### 测试场景 1.5: 连续完成任务（Streak）

**测试步骤**:
1. 完成一个每日任务（第一次）
2. 检查任务卡片的 Streak 显示
3. 第二天再次完成同一任务
4. 检查 Streak 是否增加

**预期结果**:
- ✅ 第一次完成：显示 `🔥 1天连续`
- ✅ 连续完成：Streak 增加（`🔥 2天连续`）
- ✅ 连续完成获得额外奖励（积分 +50%）
- ✅ 中断后 Streak 重置为 1

#### 测试场景 1.6: 删除任务

**测试步骤**:
1. 点击任务卡片的"删除"按钮
2. 确认删除对话框（如果有）

**预期结果**:
- ✅ 任务从列表中移除
- ✅ 显示 Toast 提示"任务已删除"
- ✅ 无法撤销（或有撤销功能）

#### 测试场景 1.7: 表单验证

**测试步骤**:
1. 点击"添加任务"
2. 不填写标题，直接点击"添加任务"按钮

**预期结果**:
- ✅ 显示错误提示"请输入任务标题"
- ✅ 表单不提交
- ✅ 焦点回到标题输入框

---

### B. 奖励系统功能测试

#### 测试场景 2.1: 添加奖励

**测试步骤**:
1. 切换到"奖励商店"标签
2. 点击"➕ 添加奖励"
3. 填写奖励信息：
   - 标题：`30分钟平板时间`
   - 描述：`可以玩喜欢的游戏`
   - 成本：50 积分
   - 类别：选择"娱乐"
   - 图标：选择 🎮
4. 点击"添加奖励"

**预期结果**:
- ✅ 奖励添加到商店
- ✅ 显示正确的图标、标题和成本
- ✅ 根据用户积分显示"立即兑换"或"积分不足"

#### 测试场景 2.2: 兑换奖励（积分足够）

**前置条件**: 用户有 ≥50 积分

**测试步骤**:
1. 找到成本为 50 积分的奖励
2. 点击"立即兑换"按钮

**预期结果**:
- ✅ 积分扣除 50
- ✅ 显示兑换成功动画
- ✅ Toast 提示：`🎁 兑换成功！享受你的奖励吧！`
- ✅ 奖励标记为"已兑换"状态
- ✅ 按钮变为灰色"已兑换"

#### 测试场景 2.3: 兑换奖励（积分不足）

**前置条件**: 用户积分 < 奖励成本

**测试步骤**:
1. 找到成本高于当前积分的奖励
2. 检查按钮状态

**预期结果**:
- ✅ 按钮显示为"积分不足"
- ✅ 按钮为灰色禁用状态
- ✅ 点击按钮无反应
- ✅ 显示还需要多少积分（可选）

#### 测试场景 2.4: 删除奖励

**测试步骤**:
1. 点击奖励卡片的"删除"按钮

**预期结果**:
- ✅ 奖励从商店移除
- ✅ 如果已兑换，不退还积分（或确认提示）

---

### C. 成就系统功能测试

#### 测试场景 3.1: 解锁"第一步"成就

**测试步骤**:
1. 新用户第一次完成任务

**预期结果**:
- ✅ 自动解锁"第一步"成就（🎯）
- ✅ 显示成就解锁动画
- ✅ Toast 提示：`🏆 成就解锁：第一步！`
- ✅ 成就出现在"成就墙"标签
- ✅ 用户统计中显示成就数量 +1

#### 测试场景 3.2: 解锁"坚持之星"成就

**测试步骤**:
1. 连续 7 天完成每日任务

**预期结果**:
- ✅ 在第 7 天完成后解锁"坚持之星"（⭐）
- ✅ 显示解锁动画和提示

#### 测试场景 3.3: 查看成就详情

**测试步骤**:
1. 切换到"成就墙"标签
2. 查看已解锁和未解锁的成就

**预期结果**:
- ✅ 已解锁成就显示彩色图标和解锁时间
- ✅ 未解锁成就显示灰色图标和解锁条件
- ✅ 显示进度条（例如：5/10 完成任务）

---

### D. 用户等级和经验系统测试

#### 测试场景 4.1: 获得经验值

**测试步骤**:
1. 完成一个"简单"难度任务（+2.5 经验）
2. 完成一个"中等"难度任务（+5 经验）
3. 完成一个"困难"难度任务（+10 经验）

**预期结果**:
- ✅ 经验值条增加相应数量
- ✅ 经验值数字更新
- ✅ 动画流畅

#### 测试场景 4.2: 等级提升

**测试步骤**:
1. 累积足够的经验值达到下一级（例如：Lv1 需要 50 经验）

**预期结果**:
- ✅ 显示全屏升级动画
- ✅ Toast 提示：`🎊 恭喜升级到 Lv.2！`
- ✅ 等级数字更新
- ✅ 等级称号更新（例如：初级小学生 → 进步小达人）
- ✅ 经验值重置，开始下一级

#### 测试场景 4.3: 查看用户统计

**测试步骤**:
1. 查看 UserStats 组件

**预期结果**:
- ✅ 显示正确的等级和称号
- ✅ 显示经验值进度条
- ✅ 显示可用积分和总积分
- ✅ 显示统计数据：
  - 最长连续天数
  - 完成任务总数
  - 完美日数量
- ✅ 显示解锁成就数量

---

### E. PWA 功能测试

#### 测试场景 5.1: PWA 安装提示

**测试步骤**:
1. 在支持 PWA 的浏览器（Chrome/Edge）中访问应用
2. 等待 30 秒

**预期结果**:
- ✅ 右下角弹出安装提示卡片
- ✅ 显示应用图标和名称
- ✅ 列出 3 个特性（离线、快速、原生）
- ✅ 有"立即安装"和"稍后"按钮

#### 测试场景 5.2: 安装应用

**测试步骤**:
1. 点击"立即安装"按钮
2. 在浏览器安装对话框点击"安装"

**预期结果**:
- ✅ 应用安装到桌面/应用列表
- ✅ 安装提示消失
- ✅ 图标显示正确

#### 测试场景 5.3: 启动已安装的应用

**测试步骤**:
1. 从桌面/应用列表启动应用

**预期结果**:
- ✅ 应用在独立窗口中打开
- ✅ 无浏览器地址栏和工具栏
- ✅ 主题色应用正确（标题栏颜色）
- ✅ 所有功能正常工作

#### 测试场景 5.4: 离线功能

**测试步骤**:
1. 访问应用并进行一些操作
2. 打开 Chrome DevTools → Network
3. 勾选"Offline"
4. 刷新页面

**预期结果**:
- ✅ 应用正常加载（使用缓存）
- ✅ 所有静态资源加载成功
- ✅ 可以查看已有数据
- ✅ 可以添加/修改任务（保存到 IndexedDB）
- ✅ 重新上线后数据同步

#### 测试场景 5.5: Service Worker 更新

**测试步骤**:
1. 修改代码并重新构建
2. 刷新应用

**预期结果**:
- ✅ Service Worker 检测到新版本
- ✅ 自动下载新版本
- ✅ 提示用户刷新（或自动刷新）

---

### F. 响应式设计测试

#### 测试场景 6.1: 桌面端（≥1024px）

**测试步骤**:
1. 在桌面浏览器中打开应用
2. 调整窗口大小到 1920x1080

**预期结果**:
- ✅ 布局适应大屏幕
- ✅ 所有元素清晰可见
- ✅ 合理使用空间（不过度拉伸）

#### 测试场景 6.2: 平板端（768px - 1023px）

**测试步骤**:
1. 使用 Chrome DevTools 设备模拟
2. 选择 iPad（768x1024）

**预期结果**:
- ✅ 布局自适应
- ✅ 触摸区域足够大
- ✅ 字体大小合适

#### 测试场景 6.3: 手机端（≤767px）

**测试步骤**:
1. 使用 Chrome DevTools 设备模拟
2. 选择 iPhone 12（390x844）

**预期结果**:
- ✅ 单列布局
- ✅ 按钮和点击区域足够大（≥44px）
- ✅ 文字可读（最小 16px）
- ✅ 图标清晰可见
- ✅ 无横向滚动条

#### 测试场景 6.4: 旋转屏幕

**测试步骤**:
1. 在移动设备上旋转屏幕（竖屏 ↔ 横屏）

**预期结果**:
- ✅ 布局自动适应
- ✅ 无内容溢出
- ✅ 交互正常

---

### G. 数据持久化测试

#### 测试场景 7.1: 刷新页面

**测试步骤**:
1. 添加 3 个任务
2. 完成其中 1 个
3. 兑换 1 个奖励
4. 刷新页面（F5）

**预期结果**:
- ✅ 所有任务保持不变
- ✅ 完成状态保持
- ✅ 积分和经验值保持
- ✅ 兑换记录保持

#### 测试场景 7.2: 关闭并重新打开浏览器

**测试步骤**:
1. 进行一些操作
2. 完全关闭浏览器
3. 重新打开浏览器并访问应用

**预期结果**:
- ✅ 所有数据完整保留
- ✅ 用户状态正确

#### 测试场景 7.3: 清除缓存但保留数据

**测试步骤**:
1. Chrome DevTools → Application → Clear storage
2. 只清除"Cache storage"和"Service Workers"
3. 保留"IndexedDB"和"Local storage"
4. 刷新页面

**预期结果**:
- ✅ 应用重新加载
- ✅ 用户数据完整保留

---

### H. 边界情况测试

#### 测试场景 8.1: 零积分兑换

**测试步骤**:
1. 消耗所有积分
2. 尝试兑换奖励

**预期结果**:
- ✅ 所有奖励按钮禁用
- ✅ 显示"积分不足"

#### 测试场景 8.2: 最大等级

**测试步骤**:
1. 手动修改数据库，将等级设为最高（例如 Lv.20）

**预期结果**:
- ✅ 显示最高等级称号
- ✅ 经验值条显示已满或隐藏
- ✅ 无法继续升级

#### 测试场景 8.3: 长文本处理

**测试步骤**:
1. 添加超长标题的任务（>100 字符）
2. 添加超长描述（>1000 字符）

**预期结果**:
- ✅ 文本截断或滚动
- ✅ 不破坏布局
- ✅ 使用省略号（...）

#### 测试场景 8.4: 空状态

**测试步骤**:
1. 清空所有任务
2. 清空所有奖励
3. 查看成就墙（无成就）

**预期结果**:
- ✅ 显示空状态插图和提示
- ✅ 引导用户添加第一个任务/奖励
- ✅ 界面友好

---

## 2️⃣ 性能优化

### A. Lighthouse 审计

#### 步骤：

1. **运行生产构建**：
   ```bash
   npm run build
   npm run preview
   ```

2. **打开 Lighthouse**：
   - Chrome DevTools → Lighthouse
   - 勾选所有类别：Performance, Accessibility, Best Practices, SEO, PWA
   - 选择"Mobile"设备
   - 点击"Analyze page load"

3. **检查分数**：
   - 🎯 **目标分数**: 所有类别 ≥90
   - 特别关注：
     - Performance: ≥90
     - PWA: 100
     - Accessibility: ≥95

4. **优化建议**：
   根据 Lighthouse 报告优化：
   - 减少未使用的 JavaScript
   - 优化图片尺寸和格式
   - 启用文本压缩
   - 使用 HTTP/2
   - 添加 meta 标签

### B. 性能优化清单

#### ✅ 已实现的优化：

- [x] Service Worker 缓存
- [x] IndexedDB 本地存储
- [x] React 组件懒加载（待实现）
- [x] Framer Motion 动画优化
- [x] Tailwind CSS 生产构建（自动 purge）

#### 🚀 待实现的优化：

- [ ] 图片 WebP 格式转换
- [ ] 代码分割（路由懒加载）
- [ ] 字体预加载
- [ ] 关键 CSS 内联
- [ ] 图片懒加载

---

## 3️⃣ 用户测试

### A. 测试对象

**理想测试用户**：
- 👦 6-9 岁小学生（2-3 名）
- 👨‍👩‍👧 家长（2-3 名）

### B. 测试任务

#### 儿童测试任务：

1. **任务 1**: 自己添加一个每天要做的事情（例如：刷牙）
2. **任务 2**: 完成一个任务，看看会发生什么
3. **任务 3**: 找到奖励商店，选择一个喜欢的奖励
4. **任务 4**: 告诉我你最喜欢应用的哪个部分

#### 家长测试任务：

1. 评估应用的儿童友好性
2. 测试完整的任务管理流程
3. 检查奖励系统的激励效果
4. 提供改进建议

### C. 反馈收集

**关键问题**：

1. 界面是否容易理解？
2. 按钮是否足够大且易于点击？
3. 颜色和图标是否吸引人？
4. 完成任务后的反馈是否令人满意？
5. 有哪些功能使用困难？
6. 希望添加什么新功能？

---

## 4️⃣ 生产环境部署

### A. 部署到 Vercel（推荐）

#### 步骤：

1. **推送代码到 GitHub**：
   ```bash
   git add .
   git commit -m "准备生产部署"
   git push origin main
   ```

2. **连接 Vercel**：
   - 访问 [vercel.com](https://vercel.com)
   - 注册/登录账号
   - 点击"New Project"
   - 导入 GitHub 仓库
   - 框架预设：Vite
   - 构建命令：`npm run build`
   - 输出目录：`dist`

3. **自动部署**：
   - 每次推送到 `main` 分支自动部署
   - 获得 HTTPS 域名（例如：`habit-app.vercel.app`）

4. **验证 PWA**：
   - 访问部署的 URL
   - 测试安装功能
   - 测试离线功能
   - 运行 Lighthouse 审计

### B. 部署到 Netlify

#### 步骤：

1. **推送代码到 GitHub**

2. **连接 Netlify**：
   - 访问 [netlify.com](https://netlify.com)
   - 注册/登录
   - 点击"Add new site"
   - 选择 GitHub 仓库
   - 构建设置：
     - Build command: `npm run build`
     - Publish directory: `dist`

3. **配置自定义域名**（可选）：
   - Netlify 提供免费的 `.netlify.app` 域名
   - 或配置自定义域名（需要购买）

### C. 部署后验证

#### 验证清单：

- [ ] HTTPS 证书正常（浏览器显示🔒）
- [ ] PWA 安装提示出现
- [ ] Service Worker 注册成功
- [ ] 离线功能正常工作
- [ ] 所有功能无错误
- [ ] Lighthouse PWA 分数 = 100
- [ ] 性能分数 ≥90
- [ ] 移动端和桌面端都能正常使用

---

## 5️⃣ 测试工具和资源

### 推荐工具：

1. **Chrome DevTools**
   - Elements: 检查 DOM 和样式
   - Console: 查看日志和错误
   - Network: 监控请求和离线
   - Application: 检查 PWA、数据库、缓存
   - Lighthouse: 性能审计

2. **React DevTools**
   - 组件树查看
   - Props 和 State 检查
   - 性能分析

3. **浏览器兼容性测试**
   - Chrome (推荐)
   - Edge
   - Firefox
   - Safari (iOS 重要！)

4. **设备测试**
   - 真实 Android 手机
   - 真实 iPhone
   - 各种屏幕尺寸

---

## ✅ 测试完成检查清单

### 功能测试：

- [ ] 所有任务管理功能正常
- [ ] 奖励系统正常工作
- [ ] 成就解锁逻辑正确
- [ ] 等级和经验系统正常
- [ ] PWA 安装和离线功能正常
- [ ] 响应式设计在所有设备上正常
- [ ] 数据持久化可靠
- [ ] 边界情况处理正确

### 性能测试：

- [ ] Lighthouse Performance ≥90
- [ ] Lighthouse PWA = 100
- [ ] Lighthouse Accessibility ≥95
- [ ] 首屏加载 <3 秒
- [ ] 交互响应 <100ms

### 用户测试：

- [ ] 至少 3 名儿童测试
- [ ] 至少 2 名家长测试
- [ ] 收集并整理反馈
- [ ] 根据反馈改进

### 部署验证：

- [ ] 成功部署到生产环境
- [ ] HTTPS 正常
- [ ] PWA 功能正常
- [ ] 所有功能在生产环境工作
- [ ] 监控和日志设置完成

---

**下一步**: 开始执行测试并优化！🚀
