# 账号登录系统使用指南

## 🎉 新功能概述

习惯养成小助手现在支持多用户账号系统！每个用户都有独立的数据和进度。

## 🔐 登录信息

### 超级管理员账号
```
用户名：mookee
密码：（请联系系统管理员获取）
角色：管理员（admin）
```

**管理员特权：**
- ✅ 可以创建新用户
- ✅ 可以删除普通用户
- ✅ 查看所有用户列表
- ✅ 拥有所有普通用户权限

## 📱 使用流程

### 1. 首次访问
- 打开应用会自动显示登录页面
- 使用超级管理员账号登录

### 2. 创建新用户（仅管理员）
1. 登录后进入 **设置** 页面
2. 在 **账号管理** 区域点击 **"添加用户"** 按钮
3. 填写新用户信息：
   - **登录用户名**：用于登录的唯一标识
   - **登录密码**：设置密码
   - **显示名称**：显示在应用中的昵称
   - **头像**：从emoji中选择一个头像
4. 点击 **"创建用户"** 完成

### 3. 登出
- 进入 **设置** 页面
- 在 **账号管理** 区域点击 **"登出"** 按钮
- 确认后返回登录页面

### 4. 切换用户
- 登出当前账号
- 使用其他账号登录

### 5. 删除用户（仅管理员）
1. 进入 **设置** → **账号管理**
2. 在用户卡片上点击 **"删除"** 按钮
3. 确认删除

**注意：**
- 不能删除当前登录的用户
- 不能删除管理员账号
- 删除操作不可恢复

## 🔒 安全说明

### 密码加密
- 密码使用 **Base64编码** 进行简单加密存储
- 仅适用于本地应用
- 生产环境建议升级为 bcrypt 或其他更安全的加密方法

### 数据隔离
- 每个用户的数据完全独立
- 任务、奖励、成就都按用户分开
- 用户之间数据互不干扰

### 登录状态
- 登录状态保存在 `localStorage`
- 关闭浏览器后仍保持登录
- 手动登出才会清除登录状态

## 👥 用户角色

### 管理员（admin）
- 拥有 👑 标识
- 可以管理所有用户
- 可以创建/删除用户

### 普通用户（user）
- 使用所有功能
- 管理自己的任务和奖励
- 无法访问用户管理功能

## 📊 数据结构变化

### 用户表（User）
新增字段：
- `username`: 登录用户名（唯一）
- `password`: 加密后的密码
- `role`: 用户角色（admin/user）

### 数据库版本
- **版本6**：添加多用户支持和认证系统
- 自动迁移，无需手动操作

## 🎯 常见问题

### Q: 忘记密码怎么办？
A: 目前没有找回密码功能。管理员可以删除用户后重新创建。未来版本会添加密码重置功能。

### Q: 可以修改用户名吗？
A: 当前版本不支持修改用户名。需要删除用户重新创建。

### Q: 数据会同步到云端吗？
A: 当前版本所有数据存储在浏览器本地（IndexedDB）。云端同步功能需要后端服务支持，可在未来版本添加。

### Q: 如何备份数据？
A: 进入 **设置** → **数据管理** → 点击 **"导出数据"** 下载备份文件。

### Q: 可以在多个设备上使用同一账号吗？
A: 可以使用同一账号登录，但数据不会自动同步。需要手动导出/导入数据。

### Q: 管理员账号可以删除吗？
A: 不可以。超级管理员账号 `mookee` 是受保护的，无法删除。

## 🚀 技术实现

### 核心文件
- `src/hooks/useAuth.ts` - 认证逻辑Hook
- `src/pages/LoginPage.tsx` - 登录页面
- `src/components/UserManagement.tsx` - 用户管理组件
- `src/lib/db.ts` - 数据库结构（包含用户表）

### 认证流程
```
1. 用户访问 → 检查登录状态（localStorage）
2. 未登录 → 显示登录页面
3. 输入用户名密码 → 查询用户表
4. 验证密码 → 设置登录状态
5. 进入应用 → 加载用户数据
6. 登出 → 清除登录状态
```

### API接口（useAuth Hook）
```typescript
const {
  login,           // 登录
  logout,          // 登出
  checkAuth,       // 检查登录状态
  createUser,      // 创建用户（仅管理员）
  getAllUsers,     // 获取所有用户（仅管理员）
  deleteUser,      // 删除用户（仅管理员）
  isLoading,       // 加载状态
  error,           // 错误信息
} = useAuth();
```

## 📝 更新日志

### v1.1.0 (2025-12-05)
- ✅ 新增用户认证系统
- ✅ 新增超级管理员账号
- ✅ 新增用户管理功能
- ✅ 新增登录/登出功能
- ✅ 新增多用户支持
- ✅ 升级数据库到版本6

---

**祝使用愉快！🎉**

如有问题或建议，请联系管理员。
